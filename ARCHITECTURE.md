# WangChain æ¶æ„æ–‡æ¡£ | Architecture Documentation

## ç³»ç»Ÿæ¶æ„ | System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WangChain Framework                     â”‚
â”‚                   åŸºäºLangChainçš„LLMåº”ç”¨æ¡†æ¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ Application Layer                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   åŸºç¡€LLM     â”‚  â”‚   RAGåº”ç”¨    â”‚  â”‚   Agentåº”ç”¨   â”‚       â”‚
â”‚  â”‚  Basic LLM   â”‚  â”‚  RAG Apps    â”‚  â”‚  Agent Apps  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒæ¨¡å— Core Modules                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  LLMå·¥å‚      â”‚  â”‚  RAGæ£€ç´¢å™¨   â”‚  â”‚  Agentæ‰§è¡Œå™¨  â”‚       â”‚
â”‚  â”‚  LLMFactory  â”‚  â”‚ RAGRetriever â”‚  â”‚AgentExecutor â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è®¾è®¡æ¨¡å¼å±‚ Design Pattern Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   å·¥å‚æ¨¡å¼    â”‚  â”‚  æ„å»ºå™¨æ¨¡å¼   â”‚  â”‚   å•ä¾‹æ¨¡å¼    â”‚       â”‚
â”‚  â”‚   Factory    â”‚  â”‚   Builder    â”‚  â”‚  Singleton   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½å±‚ Infrastructure Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   é…ç½®ç®¡ç†    â”‚  â”‚   æ—¥å¿—ç³»ç»Ÿ    â”‚  â”‚   é”™è¯¯å¤„ç†    â”‚       â”‚
â”‚  â”‚Configuration â”‚  â”‚   Logging    â”‚  â”‚Error Handlingâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶ | Core Components

### 1. LLMæ ¸å¿ƒ | LLM Core

**LLMFactory (å·¥å‚æ¨¡å¼ Factory Pattern)**
- åˆ›å»ºä¸åŒç±»å‹çš„LLMå®ä¾‹
- æ”¯æŒOpenAIåŠå…¶ä»–LLMæä¾›å•†
- ç»Ÿä¸€çš„æ¥å£è®¾è®¡

**LLMBuilder (æ„å»ºå™¨æ¨¡å¼ Builder Pattern)**
- çµæ´»é…ç½®LLMå‚æ•°
- é“¾å¼è°ƒç”¨API
- ç±»å‹å®‰å…¨

### 2. RAGæ¨¡å— | RAG Module

**æ–‡æ¡£å¤„ç†æµç¨‹ Document Processing Pipeline:**
```
æ–‡æ¡£åŠ è½½ â†’ æ–‡æœ¬åˆ†å‰² â†’ å‘é‡åŒ– â†’ å­˜å‚¨ â†’ æ£€ç´¢ â†’ ç”Ÿæˆ
Load â†’ Split â†’ Embed â†’ Store â†’ Retrieve â†’ Generate
```

**ç»„ä»¶ Components:**
- `DocumentLoader`: å¤šæ ¼å¼æ–‡æ¡£åŠ è½½å™¨
- `VectorStoreFactory`: å‘é‡å­˜å‚¨å·¥å‚
- `RAGRetriever`: æ™ºèƒ½æ£€ç´¢å™¨
- `RAGChain`: é—®ç­”é“¾

### 3. Agentæ¨¡å— | Agent Module

**ReActæ¡†æ¶ ReAct Framework:**
```
é—®é¢˜ â†’ æ€è€ƒ â†’ è¡ŒåŠ¨ â†’ è§‚å¯Ÿ â†’ [å¾ªç¯] â†’ ç­”æ¡ˆ
Question â†’ Thought â†’ Action â†’ Observation â†’ [Loop] â†’ Answer
```

**ç»„ä»¶ Components:**
- `ToolFactory`: å·¥å…·å·¥å‚
- `AgentExecutor`: Agentæ‰§è¡Œå™¨
- `AgentBuilder`: Agentæ„å»ºå™¨

## è®¾è®¡æ¨¡å¼åº”ç”¨ | Design Pattern Applications

### å·¥å‚æ¨¡å¼ | Factory Pattern
```python
# LLMFactory
llm = LLMFactory.create_llm(model_type="openai")

# VectorStoreFactory
store = VectorStoreFactory.create_vector_store(
    store_type="chroma",
    documents=docs,
    embedding_function=embeddings
)

# ToolFactory
tools = ToolFactory.get_default_tools()
```

### æ„å»ºå™¨æ¨¡å¼ | Builder Pattern
```python
# LLMBuilder
llm = (LLMBuilder()
       .set_model_type("openai")
       .set_temperature(0.7)
       .set_max_tokens(1000)
       .build())

# AgentBuilder
agent = (AgentBuilder()
         .with_tools([tool1, tool2])
         .set_verbose(True)
         .build())
```

### å•ä¾‹æ¨¡å¼ | Singleton Pattern
```python
# ConfigManager - ç¡®ä¿å…¨å±€é…ç½®ä¸€è‡´æ€§
config1 = ConfigManager()
config2 = ConfigManager()
assert config1 is config2  # True
```

## å®‰å…¨ä¸æ€§èƒ½ | Security & Performance

### å®‰å…¨ç‰¹æ€§ | Security Features
- âœ… APIå¯†é’¥éªŒè¯
- âœ… ç¯å¢ƒå˜é‡éš”ç¦»
- âœ… è¾“å…¥éªŒè¯å’Œæ¸…æ´—
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… å®‰å…¨çš„æ•°å­¦è¡¨è¾¾å¼è®¡ç®—

### æ€§èƒ½ä¼˜åŒ– | Performance Optimization
- âš¡ å‘é‡åŒ–æ£€ç´¢
- âš¡ å¼‚æ­¥å¤„ç†æ”¯æŒï¼ˆå¯æ‰©å±•ï¼‰
- âš¡ ç¼“å­˜æœºåˆ¶ï¼ˆå¯æ‰©å±•ï¼‰
- âš¡ è¿æ¥æ± ç®¡ç†ï¼ˆå¯æ‰©å±•ï¼‰
- âš¡ é‡è¯•æœºåˆ¶

### é«˜å¯ç”¨æ€§ | High Availability
- ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶
- ğŸ”„ é”™è¯¯é™çº§å¤„ç†
- ğŸ”„ æ—¥å¿—è¿½è¸ª
- ğŸ”„ è¶…æ—¶æ§åˆ¶

## é…ç½®ç®¡ç† | Configuration Management

### é…ç½®å±‚æ¬¡ | Configuration Hierarchy
```
ç¯å¢ƒå˜é‡ (.env) â†’ ConfigManager â†’ ç»„ä»¶é…ç½®
Environment Variables â†’ ConfigManager â†’ Component Config
```

### é…ç½®éªŒè¯ | Configuration Validation
- Pydanticæ¨¡å‹éªŒè¯
- ç±»å‹æ£€æŸ¥
- èŒƒå›´éªŒè¯
- è‡ªå®šä¹‰éªŒè¯å™¨

## æ‰©å±•æ€§ | Extensibility

### æ·»åŠ æ–°çš„LLMæä¾›å•† | Adding New LLM Providers
```python
# åœ¨LLMFactoryä¸­æ·»åŠ æ–°æ–¹æ³•
@staticmethod
def _create_custom_llm(llm_config, **kwargs):
    # å®ç°è‡ªå®šä¹‰LLMåˆ›å»ºé€»è¾‘
    pass
```

### æ·»åŠ æ–°çš„å‘é‡å­˜å‚¨ | Adding New Vector Stores
```python
# åœ¨VectorStoreFactoryä¸­æ·»åŠ æ–°ç±»å‹
if store_type.lower() == "custom":
    return CustomVectorStore.from_documents(...)
```

### æ·»åŠ æ–°çš„Agentå·¥å…· | Adding New Agent Tools
```python
# åˆ›å»ºè‡ªå®šä¹‰å·¥å…·
custom_tool = Tool(
    name="Custom Tool",
    func=custom_function,
    description="Tool description"
)

# æ·»åŠ åˆ°Agent
agent.add_tool(custom_tool)
```

## æµ‹è¯•ç­–ç•¥ | Testing Strategy

### å•å…ƒæµ‹è¯• | Unit Tests
- é…ç½®æ¨¡å—æµ‹è¯•
- æ ¸å¿ƒæ¨¡å—æµ‹è¯•
- å·¥å…·æ¨¡å—æµ‹è¯•

### é›†æˆæµ‹è¯• | Integration Tests
- RAGç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯æ·»åŠ ï¼‰
- Agentå·¥ä½œæµæµ‹è¯•ï¼ˆå¯æ·»åŠ ï¼‰

### ç¤ºä¾‹éªŒè¯ | Example Validation
- åŸºç¡€LLMç¤ºä¾‹
- RAGåº”ç”¨ç¤ºä¾‹
- Agentåº”ç”¨ç¤ºä¾‹

## æœ€ä½³å®è·µ | Best Practices

### ä»£ç ç»„ç»‡ | Code Organization
âœ… æ¨¡å—åŒ–è®¾è®¡
âœ… æ¸…æ™°çš„æ¥å£å®šä¹‰
âœ… å®Œå–„çš„æ–‡æ¡£æ³¨é‡Šï¼ˆä¸­è‹±åŒè¯­ï¼‰
âœ… ç±»å‹æç¤º

### é”™è¯¯å¤„ç† | Error Handling
âœ… è‡ªå®šä¹‰å¼‚å¸¸ç±»
âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†è£…é¥°å™¨
âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
âœ… ä¼˜é›…çš„é™çº§

### é…ç½®ç®¡ç† | Configuration Management
âœ… ç¯å¢ƒå˜é‡ä¼˜å…ˆ
âœ… åˆç†çš„é»˜è®¤å€¼
âœ… éªŒè¯å’Œç±»å‹å®‰å…¨
âœ… æ–‡æ¡£åŒ–çš„é…ç½®é¡¹
